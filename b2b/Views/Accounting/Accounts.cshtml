@model List<b2b.Controllers.AccountViewModel>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Cari Listesi";
}

    <style>
    .status-badge { padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 12px; }
    .status-active { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status-inactive { background-color: #f8f9fa; color: #6c757d; border: 1px solid #dee2e6; }
    .table-action .btn { margin: 0 2px; border-radius: 50%; width: 35px; height: 35px; display: inline-flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
    .table-action .btn:hover { transform: scale(1.1); }
    .expandable-row { cursor: pointer; transition: background-color 0.3s ease; }
    .expandable-row:hover { background-color: #f8f9fc !important; }
    .expanded-details { display: none; background-color: #f8f9fc; border-top: 1px solid #e3e6f0; }
    .expanded-details.show { display: table-row; }
    .expanded-content { padding: 20px; background-color: #f8f9fc; }
    .detail-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid #e3e6f0; }
    .detail-label { font-weight: 600; color: #5a5c69; }
    .detail-value { color: #858796; }
    </style>

                    <div class="container-fluid flex-grow-1 container-p-y">
    <div class="d-flex justify-content-between align-items-center">
        <div>
                                <h4 class="font-weight-bold py-3 mb-0">Cari Listesi</h4>
                            </div>
                            <div>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-add-account">
                <i class="feather icon-plus mr-2"></i> Yeni Cari
                                </button>
                            </div>
                        </div>
                        
                        <div class="text-muted small mt-0 mb-4 d-block breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="#"><i class="feather icon-home"></i></a></li>
            <li class="breadcrumb-item"><a href="#">Cari Yönetimi</a></li>
            <li class="breadcrumb-item active">Cari Listesi</li>
                            </ol>
                        </div>

                        <div class="card filter-card">
                            <div class="card-body">
                                <div class="form-row align-items-center">
                                    <div class="col-md my-2">
                                        <label class="form-label">Durum</label>
                                        <select class="custom-select" id="statusFilter">
                                            <option value="">Tümü</option>
                                            <option value="Aktif">Aktif</option>
                                            <option value="Pasif">Pasif</option>
                                        </select>
                                    </div>
                                    <div class="col-md my-2">
                                        <label class="form-label">Arama</label>
                                        <input type="text" class="form-control" id="searchFilter" placeholder="Cari adı veya e-posta ile ara...">
                                    </div>
                                    <div class="col-md my-2">
                                        <label class="form-label">Cari Grubu</label>
                                                                                 <select class="custom-select" id="groupFilter">
                                             <option value="">Tümü</option>
                                             <option value="Müşteri">Müşteri</option>
                                             <option value="Tedarikçi">Tedarikçi</option>
                                             <option value="Ortak">Ortak</option>
                                         </select>
                                    </div>
                                    <div class="col-md my-2">
                                        <label class="form-label">Bakiye Aralığı</label>
                                        <select class="custom-select" id="balanceFilter">
                                            <option value="">Tümü</option>
                                            <option value="positive">Pozitif Bakiye</option>
                                            <option value="negative">Negatif Bakiye</option>
                                            <option value="zero">Sıfır Bakiye</option>
                                        </select>
                                    </div>
                <div class="col-md my-2">
                    <label class="form-label">Kayıt Tarihi</label>
                    <input type="date" class="form-control" id="startDateFilter" placeholder="Başlangıç tarihi">
                </div>
                <div class="col-md my-2">
                    <label class="form-label">Bitiş Tarihi</label>
                    <input type="date" class="form-control" id="endDateFilter" placeholder="Bitiş tarihi">
                </div>
                                    <div class="col-md col-xl-2 my-2">
                                        <label class="form-label d-none d-md-block">&nbsp;</label>
                    <div class="btn-group btn-block" role="group">
                        <button type="button" class="btn btn-primary" id="applyFilters">
                            <i class="feather icon-filter mr-1"></i> Filtrele
                        </button>
                        <button type="button" class="btn btn-secondary" id="clearFilters">
                            <i class="feather icon-refresh-cw mr-1"></i> Temizle
                        </button>
                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-xl-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="accounts-table" class="table mb-0">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th>Tarih</th>
                                                        <th>Cari Adı</th>
                                                        <th>Cari Grubu</th>
                                                        <th>E-posta</th>
                                                        <th>Telefon</th>
                                                        <th>Bakiye (₺)</th>
                                                        <th>Durum</th>
                                                        <th>İşlemler</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    @foreach (var account in Model)
                                                    {
                                                        <tr class="expandable-row" data-id="@account.Id">
                                                            <td class="align-middle">
                                            @(account.LastTransactionDate?.ToString("dd.MM.yyyy") ?? account.CreatedDate.ToString("dd.MM.yyyy"))
                                                            </td>
                                                            <td class="align-middle">
                                                                <div>
                                                                    <a href="#!" class="text-body font-weight-semibold">@account.Name</a>
                                                                    <div class="text-muted small">Cari No: @account.Id</div>
                                                                </div>
                                                            </td>
                                        <td class="align-middle">@(string.IsNullOrEmpty(account.CustomerGroup) ? "Müşteri" : account.CustomerGroup)</td>
                                        <td class="align-middle">@account.Email</td>
                                        <td class="align-middle">@account.Phone</td>
                                                            <td class="align-middle">
                                                                <span class="@(account.Balance >= 0 ? "text-success" : "text-danger") font-weight-semibold">
                                                                    @account.Balance.ToString("N2") ₺
                                                                </span>
                                                            </td>
                                                            <td class="align-middle">
                                                                @if (account.Status == "Aktif")
                                                                {
                                                                    <span class="status-badge status-active">@account.Status</span>
                                                                }
                                                                else
                                                                {
                                                                    <span class="status-badge status-inactive">@account.Status</span>
                                                                }
                                                            </td>
                                                            <td class="table-action">
                                                                <a href="/Accounting/Statement/@account.Id" class="btn btn-icon btn-outline-primary" title="Cari Ekstresi Görüntüle">
                                                                    <i class="feather icon-file-text"></i>
                                                                </a>
                                                                                         <a href="javascript:void(0)" onclick="viewCustomerOrderHistory(@account.Id, '@account.Name')" class="btn btn-icon btn-outline-info" title="Sipariş Geçmişini Gör">
                                                 <i class="feather icon-shopping-cart"></i>
                                             </a>
                                                                <a href="#!" class="btn btn-icon btn-outline-success" title="Carinin Bilgilerini Düzenle" onclick="editAccount(@account.Id)">
                                                                    <i class="feather icon-edit"></i>
                                                                </a>
                                                                <a href="#!" class="btn btn-icon btn-outline-danger" title="Carileri Sil" onclick="deleteAccount(@account.Id)">
                                                                    <i class="feather icon-trash-2"></i>
                                                                </a>
                                                            </td>
                                                        </tr>
                                                        <tr class="expanded-details" id="details-@account.Id">
                                                            <td colspan="8">
                                                                <div class="expanded-content">
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="detail-item">
                                                                                <span class="detail-label">Vergi Numarası:</span>
                                                            <span class="detail-value">@(string.IsNullOrEmpty(account.TaxNumber) ? "-" : account.TaxNumber)</span>
                                                                            </div>
                                                                            <div class="detail-item">
                                                                                <span class="detail-label">Vergi Dairesi:</span>
                                                            <span class="detail-value">@(string.IsNullOrEmpty(account.TaxOffice) ? "-" : account.TaxOffice)</span>
                                                                            </div>
                                                                            <div class="detail-item">
                                                                                <span class="detail-label">Kayıt Tarihi:</span>
                                                            <span class="detail-value">@account.CreatedDate.ToString("dd.MM.yyyy")</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="detail-item">
                                                                                <span class="detail-label">Adres:</span>
                                                            <span class="detail-value">@(string.IsNullOrEmpty(account.Address) ? "-" : account.Address)</span>
                                                                            </div>
                                                                            <div class="detail-item">
                                                                                <span class="detail-label">İletişim Kişisi:</span>
                                                                                <span class="detail-value">@account.Name</span>
                                                                            </div>
                                                                            <div class="detail-item">
                                                                                <span class="detail-label">Son İşlem:</span>
                                                            <span class="detail-value">@(account.LastTransactionDate.HasValue && account.LastTransactionDate.Value > DateTime.MinValue ? account.LastTransactionDate.Value.ToString("dd.MM.yyyy") : "-")</span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

<!-- Modals -->
<div class="modal fade" id="modal-add-account" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Yeni Cari Ekle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addAccountForm">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floating-label" for="AccountName">
                                    Cari Adı <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control" id="AccountName" required>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floating-label" for="AccountEmail">
                                    E-posta <span class="text-danger">*</span>
                                </label>
                                <input type="email" class="form-control" id="AccountEmail" required>
                            </div>
                        </div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="AccountPhone">Telefon</label><input type="text" class="form-control" id="AccountPhone"></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="AccountAddress">Adres</label><input type="text" class="form-control" id="AccountAddress"></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="AccountTaxNumber">Vergi Numarası</label><input type="text" class="form-control" id="AccountTaxNumber"></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="AccountTaxOffice">Vergi Dairesi</label><input type="text" class="form-control" id="AccountTaxOffice"></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="AccountBalance">Başlangıç Bakiyesi</label><input type="number" step="0.01" class="form-control" id="AccountBalance" placeholder="0.00"></div></div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="floating-label" for="AccountGroup">
                                    Cari Grubu <span class="text-danger">*</span>
                                </label>
                                <select class="form-control" id="AccountGroup" style="min-height: 38px; border: 2px solid #e3e6f0;">
                                    <option value="Müşteri">Müşteri</option>
                                    <option value="Tedarikçi">Tedarikçi</option>
                                    <option value="Ortak">Ortak</option>
                                </select>
                                <small class="form-text text-muted">Cari türünü seçin</small>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <label class="switcher">
                                <input type="checkbox" class="switcher-input" checked>
                                <span class="switcher-indicator"><span class="switcher-yes"></span><span class="switcher-no"></span></span>
                                <span class="switcher-label">Aktif</span>
                            </label>
                        </div>
                        <div class="col-sm-12"><button type="submit" class="btn btn-primary">Kaydet</button> <button type="button" class="btn btn-danger" onclick="clearForm()">Temizle</button></div>
                            </div>
                </form>
                            </div>
                        </div>
                            </div>
                        </div>

<div class="modal fade" id="modal-edit-account" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cari Düzenle</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                            </div>
            <div class="modal-body">
                <form id="editAccountForm">
                    <input type="hidden" id="EditAccountId">
                    <div class="row">
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="EditAccountName">Cari Adı</label><input type="text" class="form-control" id="EditAccountName" required></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="EditAccountEmail">E-posta</label><input type="email" class="form-control" id="EditAccountEmail" required></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="EditAccountPhone">Telefon</label><input type="text" class="form-control" id="EditAccountPhone"></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="EditAccountAddress">Adres</label><input type="text" class="form-control" id="EditAccountAddress"></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="EditAccountTaxNumber">Vergi Numarası</label><input type="text" class="form-control" id="EditAccountTaxNumber"></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="EditAccountTaxOffice">Vergi Dairesi</label><input type="text" class="form-control" id="EditAccountTaxOffice"></div></div>
                        <div class="col-sm-6"><div class="form-group"><label class="floating-label" for="EditAccountBalance">Bakiye</label><input type="number" step="0.01" class="form-control" id="EditAccountBalance" placeholder="0.00"></div></div>
                        <div class="col-sm-6">
                            <label class="switcher">
                                <input type="checkbox" class="switcher-input" id="EditAccountIsActive" checked>
                                <span class="switcher-indicator"><span class="switcher-yes"></span><span class="switcher-no"></span></span>
                                <span class="switcher-label">Aktif</span>
                            </label>
                        </div>
                        <div class="col-sm-12"><button type="submit" class="btn btn-primary">Güncelle</button> <button type="button" class="btn btn-secondary" data-dismiss="modal">İptal</button></div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
// Alert gösterme fonksiyonu
function showAlert(message, type) {
    var alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-' + type + ' alert-dismissible fade show';
    alertDiv.innerHTML = message + '<button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>';
    document.querySelector('.container-p-y').appendChild(alertDiv);
    setTimeout(function(){ 
        if(alertDiv && alertDiv.parentNode){ 
            alertDiv.parentNode.removeChild(alertDiv); 
        } 
    }, 3000);
}

    $(document).ready(function() {
    // Filtrele
        $('#applyFilters').on('click', function() {
            var statusFilter = $('#statusFilter').val();
            var groupFilter = $('#groupFilter').val();
            var balanceFilter = $('#balanceFilter').val();
            var searchFilter = $('#searchFilter').val();
        var startDateFilter = $('#startDateFilter').val();
        var endDateFilter = $('#endDateFilter').val();

        $('.expandable-row').hide();
        $('.expanded-details').hide();

        $('.expandable-row').each(function() {
            var row = $(this);
            var name = row.find('td:eq(1)').text().trim();
            var email = row.find('td:eq(3)').text().trim();
            var group = row.find('td:eq(2)').text().trim();
            var status = row.find('td:eq(6)').text().trim();
            var balanceText = row.find('td:eq(5)').text().trim();
            var balance = parseFloat(balanceText.replace(/[^\d.-]/g, '')) || 0;
            var dateText = row.find('td:eq(0)').text().trim();
            var date = new Date(dateText.split('.').reverse().join('-'));

            var showRow = true;

                if (searchFilter) {
                    var searchLower = searchFilter.toLowerCase();
                if (!name.toLowerCase().includes(searchLower) && !email.toLowerCase().includes(searchLower)) showRow = false;
            }
            if (groupFilter && group !== groupFilter) showRow = false;
            if (statusFilter && status !== statusFilter) showRow = false;
                if (balanceFilter) {
                if (balanceFilter === 'positive' && balance <= 0) showRow = false;
                if (balanceFilter === 'negative' && balance >= 0) showRow = false;
                if (balanceFilter === 'zero' && balance !== 0) showRow = false;
            }
            if (startDateFilter && date < new Date(startDateFilter)) showRow = false;
            if (endDateFilter && date > new Date(endDateFilter)) showRow = false;

            if (showRow) row.show();
        });
    });

    $('#clearFilters').on('click', function() {
        $('#statusFilter, #groupFilter, #balanceFilter, #searchFilter, #startDateFilter, #endDateFilter').val('');
        $('.expandable-row').show();
        $('.expanded-details').hide();
    });

    // Expandable rows
        $('.expandable-row').on('click', function(e) {
        if ($(e.target).closest('.table-action').length > 0) return;
            var rowId = $(this).data('id');
            var detailsRow = $('#details-' + rowId);
        $('.expanded-details').not(detailsRow).removeClass('show').hide();
        $('.expandable-row').not(this).removeClass('bg-light');
        if (detailsRow.hasClass('show')) { detailsRow.removeClass('show').hide(); $(this).removeClass('bg-light'); }
        else { detailsRow.addClass('show').show(); $(this).addClass('bg-light'); }
    });

    // Forms
    $('#addAccountForm').on('submit', function(e) { e.preventDefault(); addAccount(); });
    $('#editAccountForm').on('submit', function(e) { e.preventDefault(); updateAccount(); });

        $('.modal .close, .modal .btn-secondary').on('click', function() {
            $(this).closest('.modal').modal('hide');
            $('body').removeClass('modal-open');
            $('.modal-backdrop').remove();
        });
    });

    function addAccount() {
        var accountData = {
            Name: $('#AccountName').val(),
            Email: $('#AccountEmail').val(),
            Phone: $('#AccountPhone').val(),
        Address: $('#AccountAddress').val(),
        TaxNumber: $('#AccountTaxNumber').val(),
        TaxOffice: $('#AccountTaxOffice').val(),
            Balance: parseFloat($('#AccountBalance').val()) || 0,
            CustomerGroup: $('#AccountGroup').val(),
            IsActive: $('.switcher-input').is(':checked')
        };
        if (!accountData.Name || !accountData.Email) {
        showAlert('Cari adı ve e-posta alanları zorunludur!', 'danger');
            return;
        }
            fetch('/Accounting/AddAccount', {
                method: 'POST',
        headers: { 'Content-Type':'application/json', 'X-Requested-With':'XMLHttpRequest' },
                body: JSON.stringify(accountData)
    }).then(r=>r.json()).then(function(r){
        if(r && r.success){
                    $('#modal-add-account').modal('hide');
            showAlert(r.message||'Cari eklendi', 'success');
            setTimeout(function(){ location.reload(); }, 500);
                } else {
            showAlert('Hata: '+(r&&r.message||''), 'danger');
        }
    }).catch(function(err){ showAlert('Bir hata oluştu!', 'danger'); });
}

function clearForm(){
        $('#AccountName').val('');
        $('#AccountEmail').val('');
        $('#AccountPhone').val('');
    $('#AccountAddress').val('');
    $('#AccountTaxNumber').val('');
    $('#AccountTaxOffice').val('');
        $('#AccountBalance').val('');
        $('#AccountGroup').val('Müşteri');
        $('.switcher-input').prop('checked', true);
    }

function updateAccount(){
    var data = {
        Id: parseInt($('#EditAccountId').val(),10),
        Name: $('#EditAccountName').val(),
        Email: $('#EditAccountEmail').val(),
        Phone: $('#EditAccountPhone').val(),
        Address: $('#EditAccountAddress').val(),
        TaxNumber: $('#EditAccountTaxNumber').val(),
        TaxOffice: $('#EditAccountTaxOffice').val(),
        Balance: parseFloat($('#EditAccountBalance').val()||'0'),
        IsActive: $('#EditAccountIsActive').is(':checked')
    };
    fetch('/Accounting/UpdateAccount', {
        method: 'POST',
        headers: { 'Content-Type':'application/json', 'X-Requested-With':'XMLHttpRequest' },
        body: JSON.stringify(data)
    }).then(r=>r.json()).then(function(r){
        if(r && r.success){
            $('#modal-edit-account').modal('hide');
            // Satırdaki değerleri güncelle
            var id = data.Id;
            var $row = $('.expandable-row[data-id="'+id+'"]');
            if($row.length){
                $row.find('td').eq(1).find('a.text-body').text(data.Name);
                $row.find('td').eq(3).text(data.Email||'');
                $row.find('td').eq(4).text(data.Phone||'');
                $row.find('td').eq(5).find('span').text((data.Balance||0).toLocaleString('tr-TR', {minimumFractionDigits:2})+' ₺');
                var statusHtml = data.IsActive? '<span class="status-badge status-active">Aktif</span>' : '<span class="status-badge status-inactive">Pasif</span>';
                $row.find('td').eq(6).html(statusHtml);
            }
            showAlert('Cari güncellendi', 'success');
        } else {
            showAlert('Hata: '+((r&&r.message)||''), 'danger');
        }
    }).catch(function(){ showAlert('Güncelleme sırasında hata oluştu', 'danger'); });
}

function editAccount(id) {
    fetch('/Accounting/GetAccount?id='+id, { headers: { 'X-Requested-With':'XMLHttpRequest' }})
      .then(r=>r.json()).then(function(r){ if(r.success){ var a=r.account; $('#EditAccountId').val(a.id); $('#EditAccountName').val(a.name); $('#EditAccountEmail').val(a.email); $('#EditAccountPhone').val(a.phone); $('#EditAccountAddress').val(a.address); $('#EditAccountTaxNumber').val(a.taxNumber); $('#EditAccountTaxOffice').val(a.taxOffice); $('#EditAccountBalance').val(a.balance); $('#EditAccountIsActive').prop('checked', a.status === 'Aktif'); $('#modal-edit-account').modal('show'); } else { showAlert('Hata: '+(r.message||''), 'danger'); } });
}

function deleteAccount(id) {
    if (!confirm('Bu cariyi silmek istediğinizden emin misiniz?')) return;
    
    console.log('Silme işlemi başlatıldı, ID:', id);
    
    fetch('/Accounting/DeleteAccount', {
        method: 'POST',
        headers: { 'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8', 'X-Requested-With':'XMLHttpRequest' },
        body: new URLSearchParams({ id: id })
    })
    .then(response => {
        console.log('Response status:', response.status);
        return response.json();
    })
    .then(function(result){
        console.log('Response data:', result);
        
        if(result && result.success){
            // Hem ana satırı hem de detay satırını bul ve kaldır
            var $row = $('tr[data-id="'+id+'"]');
            var $details = $('#details-'+id);
            
            console.log('Bulunan satır:', $row.length, 'Bulunan detay:', $details.length);
            
            if($row.length > 0) {
                // CSS transition ile animasyonlu silme
                $row.css('opacity', '0').css('transform', 'translateX(-100%)');
                setTimeout(function() {
                    $row.remove();
                    console.log('Ana satır kaldırıldı');
                }, 300);
            }
            
            if($details.length > 0) {
                $details.css('opacity', '0').css('transform', 'translateX(-100%)');
                setTimeout(function() {
                    $details.remove();
                    console.log('Detay satırı kaldırıldı');
                }, 300);
            }
            
            showAlert('Cari başarıyla silindi', 'success');
        } else {
            console.error('Silme başarısız:', result.message);
            showAlert('Silme başarısız: ' + (result && result.message || 'Bilinmeyen hata'), 'danger');
        }
    })
    .catch(function(error){
        console.error('Fetch hatası:', error);
        showAlert('Bir hata oluştu: ' + error.message, 'danger');
    });
}

// Cari sipariş geçmişini görüntüle
function viewCustomerOrderHistory(customerId, customerName) {
    console.log('CustomerOrderHistory çağrıldı:', customerId, customerName);
    
    // Aynı sekmede aç
    var url = '/Accounting/CustomerOrderHistory/' + customerId;
    console.log('Açılacak URL:', url);
    
    // Aynı sekmede aç
    window.location.href = url;
}
</script>
}



